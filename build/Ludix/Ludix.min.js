"use strict";!function(a,b){function c(){d.load.audio=function(a,b){d.system.expectedResources+=1;var c=new XMLHttpRequest,e=void 0===b?a:b;c.open("GET",d.system.resourcePath+d.system.soundPath+a+d.system.audioType,!0),c.responseType="arraybuffer",c.onload=function(){d.audio.context.decodeAudioData(c.response,function(b){d.sound[e]=b,d.system.loadedResources+=1,d.log("Loaded audio file "+a)},function(){d.alert("There was a problem loading "+a+".")})},c.send()},d.objects.SoundEffect=function(a){void 0===a&&alert("Error accessing soundbuffer "+a),this.buffer=a},d.objects.soundFX=d.objects.SoundEffect,d.objects.SoundEffect.prototype.play=function(a){var b=d.audio.context.createBufferSource();b.buffer=d.sound[this.buffer];var c=d.audio.context.createPanner(),e=d.audio.context.createGain();return e.gain.value=a,c.connect(d.audio.soundFX),c.panningModel="equalpower",c.setPosition(0,0,0),e.connect(c),b.connect(e),b.start(0),d.log("playing sound"),{source:b,gain:e,pan:c}},d.objects.Music=function(a){void 0===a&&alert("Error accessing soundbuffer "+a),this.buffer=a},d.objects.Music.prototype.play=function(a){var b=d.audio.context.createBufferSource();b.buffer=d.sound[this.buffer],b.loop=!0;var c=d.audio.context.createPanner(),e=d.audio.context.createGain();return e.gain.value=a,c.connect(d.audio.soundFX),c.panningModel="equalpower",c.setPosition(0,0,0),e.connect(c),b.connect(e),b.start(0),d.log("playing sound"),{source:b,gain:e,pan:c}}}void 0===window.performance&&(window.performance={}),void 0===window.performance.now&&(window.performance.now=function(){return Date.now()}),Array.prototype.mapQuick=function(a){for(var b=this.length,c=0;b>c;c++)a(this[c],c);return this},Array.prototype.sortBy=function(a,b){var c=this.length;void 0===b&&(b=1);for(var d=0;c>d;d++)this[d]instanceof Array&&this[d].sortBy(a,b);this.sort(function(c,d){var e=+c[a],f=+d[a];return b*(e-f)})},Array.prototype.getRandomElement=function(){return this[Math.floor(Math.random()*this.length)]},Array.prototype.removeElement=function(a){alert(2);var b=this.indexOf(a);return-1!==b&&(alert("removed "+this[b]),this.splice(b,1)),this},Array.prototype.draw=function(a,b){for(var c=this.length,d=0;c>d;d++)this[d]&&this[d].draw&&this[d].draw(a,b)},Array.prototype.update=function(a){for(var b=this.length,c=0;b>c;c++)this[c]&&this[c].update&&this[c].update(a)},Array.prototype.handleClick=function(a,b,c){for(var d=this.length,e=d-1;e>=0;e--)if(this[e].handleClick&&this[e].handleClick(a,b,c))return!0},Number.prototype.clamp=function(a,b){return Math.min(Math.max(this,a),b)},Number.prototype.isBetween=function(a,b){return this===this.clamp(a,b)},Math.jordanCurve=function(a,b,c){for(var d=!1,e=c.length,f=0,g=e-1;e>f;g=f++)c[f][1]>b!=c[g][1]>b&&a<(c[g][0]-c[f][0])*(b-c[f][1])/(c[g][1]-c[f][1])+c[f][0]&&(d=!d);return d},Math.HSLtoRGB=function(){},Math.log10=function(a){return Math.log(a)/Math.LN10},Math.degToRad=function(a){return a*(Math.PI/180)},Math.radToDeg=function(a){return a*(180/Math.PI)},Math.vectorX=function(a,b){switch(b){case 0:return a;case 180:return-a;case 90:case-90:return 0;default:return Math.cos(Math.degToRad(b))*a}},Math.vectorY=function(a,b){switch(b){case 0:case 180:return 0;case 90:return-a;case-90:return a;default:return Math.sin(Math.degToRad(b))*a}},Math.Vector=function(a,b){this.magnitude=a,this.direction=b},Math.Vector.prototype.addVector=function(a){var b=Math.degToRad(this.direction),c=Math.degToRad(a.direction),d=Math.cos(b)*this.magnitude,e=Math.cos(c)*a.magnitude,f=-Math.sin(b)*this.magnitude,g=-Math.sin(c)*a.magnitude,h=d+e,i=f+g,j=Math.atan(i/h),k=Math.sqrt(Math.pow(h,2)+Math.pow(i,2));this.magnitude=k,this.direction=j},Math.rotatePoint=function(a,b,c){var d=Math.cos(c),e=Math.sin(c),f=d*a+e*b,g=-(e*a)+d*b;return{x:f,y:g}};var d={};d.system={},d.objects={},d.game={},d.pipe={},d.log=console.log,d.alert=alert,d.start=function(){var a=d.game,b=d.system;a.settings(),b.setup(),a.resources(),b.setLoadScreen();var c=function(){requestAnimationFrame(c);var a=d.system;void 0!==a.nextScene&&(a.currentScene=a.nextScene,a.nextScene=void 0);var b=a.currentScene,e=a.now=window.performance.now(),f=a.dt=a.timeScale*(a.now-a.then)/1e3;f>1/a.frameCap&&(f=a.dt=1/a.frameCap),a.then=e,b.update(f*(a.isPaused?0:1)),b.draw()};c()},d.log=function(a){console&&console.log&&console.log(a)},d.alert=function(a){window&&window.alert&&window.alert(a)},d.system={},d.system.orientation="landscape",d.system.fullscreen=!0,d.system.canvasRatio=1,d.system.timeScale=1,d.system.frameCap=30,d.system.now,d.system.then=window.performance.now(),d.system.dt=0,d.system.isPaused=!1,d.system.autoPause=!0,d.system.resourcePath="resources/",d.system.soundPath="sounds/",d.system.texturePath="textures/",d.system.expectedResources=0,d.system.loadedResources=0,d.system.pause=function(){d.system.isPaused=!0},d.system.resume=function(){d.system.isPaused=!1},d.system.togglePause=function(){d.system.isPaused=!d.system.isPaused},d.system.width=640,d.system.height=480,d.system.canvasLocation=document.body,Object.defineProperty(d.system,"centerX",{get:function(){return d.system.width/2}}),Object.defineProperty(d.system,"centerY",{get:function(){return d.system.height/2}}),d.system.layerAlpha=1,d.system.currentScene={},d.system.nextScene,d.system.previousScene={},d.scenes={},d.texture={},d.textures=d.texture,d.load={},d.load.texture=function(a,b){d.system.expectedResources+=1;var c=new Image,e=void 0===b?a.substr(0,a.lastIndexOf(".")):b;return c.onload=function(){d.system.loadedResources+=1,console.log("Succesfully loaded texture "+a+"."),c.onload=void 0,c.onerror=void 0},c.onerror=function(){d.alert("Something went wrong loading texture file "+a+".")},c.src=d.system.resourcePath+d.system.texturePath+a,d.texture[e]=c,c.complete&&c.onload(),c},d.load.base64texture=function(a,b){d.system.expectedResources+=1;var c=new Image;if(void 0===b)return void console.log("Error: cannot load base 64 texture without textureName argument. Please supply a name.");var e=b;return c.onload=function(){d.system.loadedResources+=1,console.log("Succesfully loaded base64 texture "+b+"."),c.onload=void 0,c.error=void 0},c.onerror=function(){d.alert("Something went wrong loading base64 texture "+b+".")},c.src=a,d.texture[e]=c,c.complete&&c.naturalWidth>0&&c.onload(),c},d.load.base64Texture=d.load.base64texture,d.load.INIFile=function(a,b){void 0===d.INI&&(d.INI={}),d.system.expectedResources+=1;var c=new XMLHttpRequest,e=d.system.resourcePath+a;c.open("GET",e,!0),c.onload=function(){for(var e=c.responseText.split("\n"),f=d.INI[b]={},g=e.length,h="",i=0;g>i;i++){var j=e[i].trim();if(""!==j){var k=j.substring(0,1);switch(k){case";":case"#":continue;case"[":var l=j.indexOf("]");-1===l&&alert("Section syntax error in INI file "+a+" at line "+i+"."),h=j.substring(1,l),f[h]={};continue;default:var m=j.split("="),n=m[0].trim(),o=m[1].trim();isNaN(o)||(o=+o),""!==h?f[h][n]=o:f[n]=o}}}d.system.loadedResources+=1},c.onerror=function(){alert("error "+c.readystate+" "+c.status)},c.send()},d.sound={},window.addEventListener("load",d.start),d.system.renderCanvas=[],d.system.renderContext=[],d.system.bufferCanvas=[],d.system.bufferContext=[],d.system.fxCanvas=[],d.system.fxContext=[],d.system.pixelCanvas=[],d.system.pixelContext=[],d.objects.Camera=function(){this.x=0,this.y=0,this.angle=0,this.zoom=1,this.z=0,this.yaw=0,this.pitch=0,this.focalLength=1e3},d.objects.Camera.update=function(){},d.objects.Camera.followObject=function(a){this.x=a.x,this.y=a.y},d.objects.Camera.prototype.setXY=function(a,b){this.x=a,this.y=b},d.objects.Camera.prototype.setXYZ=function(a,b,c){this.x=a,this.y=b,this.z=c},d.objects.Camera.prototype.setViewAngle=function(a){this.focalLength=d.system.width/a},d.objects.Camera.prototype.getViewAngle=function(){return d.system.width/this.focalLength},d.system.setResolution=function(a,b){(isNaN(a)||isNaN(b))&&alert("L.system.setResolution() parameters must be numeric."),d.system.width=a,d.system.height=b},d.system.setFullscreen=function(a){a!==!1&&a!==!0&&alert("L.system.setFullscreen() parameter must be boolean."),d.system.fullscreen=a},d.system.setOrientation=function(a){var b=a.toLowerCase();-1===["auto","landscape","portrait"].indexOf(b)&&alert('L.system.setOrientation() parameter must be "auto", "landscape", or "portrait".'),d.system.orientation=b},d.system.setAutoPause=function(a){a!==!1&&a!==!0&&alert("L.system.setAutoPause() parameter must be boolean."),d.system.autoPause=a},d.system.setCanvasLocation=function(a){a instanceof HTMLElement||alert("L.system.setCanvasLocation() parameter must be a DOM element."),d.system.canvasLocation=a},d.system.setup=function(){function a(a){return void 0!==d.system.currentScene.doKeyDown&&d.system.currentScene.doKeyDown(a),!1}function b(a){return void 0!==d.system.currentScene.doKeyUp&&d.system.currentScene.doKeyUp(a),!1}{var c=d.system.width,e=d.system.height;d.system.aspectRatio=c/e}if("auto"!==d.system.orientation)try{screen.lockOrientation(d.system.orientation)}catch(f){d.log("Warning: Screen orientation could not be locked.")}d.system.renderCanvas[0]=document.createElement("canvas"),d.system.renderCanvas[0].width=c,d.system.renderCanvas[0].height=e,d.system.canvasLocation.appendChild(d.system.renderCanvas[0]),d.system.renderContext[0]=d.system.renderCanvas[0].getContext("2d"),d.system.bufferCanvas[0]=document.createElement("canvas"),d.system.bufferCanvas[0].width=c,d.system.bufferCanvas[0].height=e,d.system.bufferContext[0]=d.system.bufferCanvas[0].getContext("2d"),d.system.fxCanvas[0]=document.createElement("canvas"),d.system.fxCanvas[0].width=c,d.system.fxCanvas[0].height=e,d.system.fxContext[0]=d.system.fxCanvas[0].getContext("2d"),d.system.pixelCanvas[0]=document.createElement("canvas"),d.system.pixelCanvas[0].width=1,d.system.pixelCanvas[0].height=1,d.system.pixelContext[0]=d.system.pixelCanvas[0].getContext("2d"),Object.defineProperty(d.system,"canvasX",{get:function(){return d.system.renderCanvas[0].offsetLeft}}),Object.defineProperty(d.system,"canvasY",{get:function(){return d.system.renderCanvas[0].offsetTop}}),d.mouse.setupEventListeners(),window.addEventListener("keydown",a,!1),window.addEventListener("keyup",b,!1),d.system.fullscreen&&(d.display.autoResize(),window.addEventListener("resize",d.display.autoResize,!0)),d.system.autoPause&&(window.addEventListener("blur",function(){d.system.isPaused=!0,d.system.then=window.performance.now()}),window.addEventListener("focus",function(){d.system.isPaused=!1,d.system.then=window.performance.now()}))},d.system.setLoadScreen=function(){d.load.base64texture("data:image/png;base64,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","base64test");var a=d.system,b=a.width,c=a.height,e=d.objects,f=new e.Scene;f.motionBlur=.8,f.bgFill="#000000";var g=new e.Textbox("https://github.com/Loycifer/Ludix.js",b/2,5*c/6);g.alignment="center",g.textFill="black",g.backgroundFill="",g.fontSize=b/30,g.visible=!0,g.autoSize(),g.onClick=function(a,d){Math.sqrt(Math.pow(a-b/2,2)+Math.pow(d-c/2,2))<j.clipRadius&&window.open("https://github.com/Loycifer/Ludix.js")},g.update=function(){var a=d.mouse;g.textFill=Math.jordanCurve(a.x,a.y,this.getVertices())?"blue":"black"};var h={handleClick:function(a,b,c){g.handleClick(a,b,c)}},i=new e.Textbox("loading",b/2,c/2);i.alignment="center",i.textFill="white",i.backgroundFill="",i.fontSize=b/30,i.y-=i.fontSize/1.5,i.visible=!0,i.autoSize();var j=new e.Sprite("base64test");j.width=402,j.height=152,j.handle={x:201,y:76},j.x=b/2,j.y=c/2,j.setScale(.6*(b/2)/j.width),j.clipRadius=0,j.draw=function(a){this.clipRadius>0&&(a.save(),a.beginPath(),a.arc(this.x,this.y,this.clipRadius,0,2*Math.PI,!1),a.clip(),this.autoDraw(a),g.draw(a),a.restore())};var k={alpha:0};k.draw=function(a){a.globalAlpha=this.alpha,a.fillStyle="black",a.fillRect(-1,-1,b+2,c+2)};var l={x:b/2,y:c/2,radius:b/8,maxRadius:Math.sqrt(Math.pow(b,2)+Math.pow(c,2))/2,orbRatio:0,orbAlpha:1,orbColor:"white",lineAlpha:1,lineColor:"white",lineWidth:4,growthRatioPerSecond:.33,divisions:0,divisionColor:"white",rainbowWidth:b/16,rainbowColors:["red","orange","yellow","green","blue","indigo","violet","white"],rainbowTimer:0,loadTimer:0,fadeTimer:0};l.updateLoading=function(b){var c=a.loadedResources/a.expectedResources,d=this.orbRatio;this.loadTimer+=b,c>d&&(this.orbRatio+=this.growthRatioPerSecond*b),this.orbRatio>c&&(this.orbRatio=c),this.orbRatio>=1&&(this.orbRatio=1,this.update=this.updateAnimating,this.draw=this.drawAnimating)},l.updateAnimating=function(a){g.update(a),this.rainbowTimer+=a,o.alpha-=a/4.5,n.alpha-=a/32,j.setScale(j.scale.x+.025*a),this.rainbowTimer>=7&&(this.update=this.updateFadeOut)},l.updateFadeOut=function(a){g.update(a),j.setScale(j.scale.x+.025*a),k.alpha+=a/2,k.alpha>1&&(k.alpha=1),1===k.alpha&&(this.fadeTimer+=a),this.fadeTimer>1&&d.game.main()};var m=new d.keyboard.Keymap;m.bindKey("esc","keyup",function(){a.loadedResources/a.expectedResources>=1&&d.game.main()}),f.keymap=m,l.update=l.updateLoading,l.drawOrb=function(a,b){i.draw(a),a.globalAlpha=this.orbAlpha,a.beginPath(),a.arc(this.x,this.y,this.radius*b,0,2*Math.PI),a.fillStyle=this.orbColor,a.fill(),a.save(),a.beginPath(),a.arc(this.x,this.y,this.radius*b,0,2*Math.PI,!1),a.clip(),i.textFill="black",i.draw(a),i.textFill="white",a.restore()},l.drawCircle=function(a){a.globalAlpha=this.orbAlpha,a.beginPath(),a.arc(this.x,this.y,this.radius,0,2*Math.PI),a.strokeStyle=this.lineColor,a.lineWidth=this.lineWidth,a.stroke()},l.drawDivisions=function(a){if(this.divisions>0){var b=this.divisions+1;a.globalAlpha=this.lineAlpha,a.strokeStyle="white",a.lineWidth=this.lineWidth/2;for(var c=0;c<this.divisions;c++)a.beginPath(),a.arc(this.x,this.y,this.radius*((c+1)/b),0,2*Math.PI),a.stroke()}},l.drawRainbow=function(a){var b=100*Math.pow(this.rainbowTimer,2),c=this.rainbowWidth,d=this.maxRadius;a.globalAlpha=1,a.strokeStyle=this.lineColor,a.lineWidth=this.lineWidth;for(var e=0;8>e;e++){var f=b-e*c;if(0>f)break;if(7===e||d>f-c){a.beginPath();var g=d>f?f:d;7===e&&(j.clipRadius=g),a.arc(this.x,this.y,g,0,2*Math.PI),a.fillStyle=this.rainbowColors[e],a.fill(),a.stroke()}}},l.drawLoading=function(a){this.drawDivisions(a),this.drawOrb(a,this.orbRatio),this.drawCircle(a)},l.drawAnimating=function(a){this.drawOrb(a,this.orbRatio),this.drawCircle(a),this.drawRainbow(a)},l.draw=l.drawLoading;var n={alpha:1,x:b/2,y:c/2};n.draw=function(a){if(this.alpha>0){a.globalAlpha=this.alpha;var d=a.createRadialGradient(this.x,this.y,0,this.x,this.y,b/1.9);d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(1,"black"),a.fillStyle=d,a.fillRect(0,0,b,c)}};var o={alpha:1,colorLineWidth:b/450,scanLineWidth:(c+1)/200,colors:["#ff0000","#00ff00","#0000ff"]};o.draw=function(a){if(this.alpha>0){for(var d=0;3>d;d++){var e=this.colorLineWidth;a.globalAlpha=this.alpha/3,a.lineWidth=e,a.strokeStyle=this.colors[d],a.beginPath();for(var f=d*e+e/2,g=c,h=b;h>f;f+=3*e)a.moveTo(f,0),a.lineTo(f,g);a.stroke()}a.globalAlpha=.9*this.alpha,a.lineWidth=1,a.strokeStyle="#000000",a.beginPath();for(var f=.5,g=c,h=b;g+1>=f;f+=2)a.moveTo(0,f),a.lineTo(h,f);a.stroke()}},f.layers.background.addObject(l),f.layers.background.addObject(h),f.layers.background.addObject(j),f.layers.background.addObject(o),f.layers.background.addObject(n),f.layers.background.addObject(k),f.setScene()},d.mouse={},d.mouse.x=0,d.mouse.y=0,d.mouse.buttons=[],d.mouse.buttons[0]={name:"left",isDown:!1,lastDown:{x:0,y:0}},d.mouse.buttons[1]={name:"middle",isDown:!1,lastDown:{x:0,y:0}},d.mouse.buttons[2]={name:"right",isDown:!1,lastDown:{x:0,y:0}},d.mouse.touchEnabled=!1,d.mouse.reset=function(){for(var a=0;3>a;a++){var b=this.buttons[a];b.isDown=!1,b.lastDown.x=0,b.lastDown.y=0}},d.system.handleClick=function(a){var b=0,c=0,e=a.type;if(a.targetTouches){b=(a.targetTouches[0].pageX-d.system.canvasX)/d.system.canvasRatio,c=(a.targetTouches[0].pageY-d.system.canvasY)/d.system.canvasRatio;var f=d.mouse.buttons[0];"touchstart"===e&&(f.isDown=!0,f.lastDown.x=b,f.lastDown.y=c),"touchend"===e&&(f.isDown=!1)}else{var f=d.mouse.buttons[a.button];b=(a.pageX-d.system.canvasX)/d.system.canvasRatio,c=(a.pageY-d.system.canvasY)/d.system.canvasRatio,"mousedown"===e&&(f.isDown=!0,f.lastDown.x=b,f.lastDown.y=c),"mouseup"===e&&(f.isDown=!1)}d.system.currentScene.handleClick&&"left"===f.name&&d.system.currentScene.handleClick(b,c,a),a.preventDefault()},d.system.setMouseCoords=function(a){"touchmove"!==a.type?(d.mouse.x=(a.pageX-d.system.canvasX)/d.system.canvasRatio,d.mouse.y=(a.pageY-d.system.canvasY)/d.system.canvasRatio):(d.mouse.x=(a.targetTouches[0].pageX-d.system.canvasX)/d.system.canvasRatio,d.mouse.y=(a.targetTouches[0].pageY-d.system.canvasY)/d.system.canvasRatio)},d.mouse.setupEventListeners=function(){"ontouchstart"in document.documentElement?(d.mouse.touchEnabled=!0,d.system.renderCanvas[0].addEventListener("touchstart",d.system.handleClick),d.system.renderCanvas[0].addEventListener("touchmove",d.system.setMouseCoords),d.system.renderCanvas[0].addEventListener("touchend",d.system.handleClick)):(d.system.renderCanvas[0].addEventListener("mousedown",d.system.handleClick),d.system.renderCanvas[0].addEventListener("mousemove",d.system.setMouseCoords),d.system.renderCanvas[0].addEventListener("mouseup",d.system.handleClick))},d.display={get width(){return d.system.renderCanvas[0].style.offsetWidth},set width(a){d.system.renderCanvas[0].style.width=a},get height(){return d.system.renderCanvas[0].style.height},set height(a){d.system.renderCanvas[0].style.height=a}},d.display.autoResize=function(){var a=window.innerWidth,b=window.innerHeight,c=d.system.width,e=d.system.height,f=a/b;f>=d.system.aspectRatio?d.system.canvasRatio=b/e:f<d.system.aspectRatio&&(d.system.canvasRatio=a/c),d.system.renderCanvas[0].style.width=c*d.system.canvasRatio+"px",d.system.renderCanvas[0].style.height=e*d.system.canvasRatio+"px",document.body.style.width="100%",document.body.style.height=Math.floor(b)+"px",document.body.style.marginTop=(Math.floor(b)-e*d.system.canvasRatio)/2+"px"},d.system.checkAudio=function(){var a=document.createElement("audio");a.canPlayType("audio/ogg")?(d.system.audioType=".ogg",d.log("Using .ogg files")):a.canPlayType("audio/mp4")?(d.system.audioType=".m4a",d.log("Using .m4a files")):a.canPlayType("audio/wav")?(d.system.audioType=".wav",d.log("Using .wav files")):d.alert("Your browser doesn't support .wav, .ogg, or .m4a audio files.")},d.system.checkAudio(),d.audio={},d.audio.context={};try{window.AudioContext=window.AudioContext||window.webkitAudioContext,d.audio.context=new AudioContext,d.audio.compressor=d.audio.context.createDynamicsCompressor(),d.audio.compressor.connect(d.audio.context.destination),d.audio.masterGain=d.audio.context.createGain(),d.audio.masterGain.connect(d.audio.compressor),d.audio.masterGain.gain.value=1,d.audio.soundFX=d.audio.context.createGain(),d.audio.soundFX.connect(d.audio.masterGain),c()}catch(e){alert("Web Audio API is not supported in this browser")}d.objects.Sprite=function(a,b){this.animations={idle:[]},this.animations.idle[0]={img:d.texture[a],length:1e3},this.animations.idle[0].img&&d.log("Created Sprite from texture '"+a+"'."),this.texture=d.texture[a],this.texture&&this.texture.width>0&&(this.width=this.texture.width,this.height=this.texture.height,d.log("Setting Sprite dimensions to "+this.width+" by "+this.height+".")),this.handle={x:0,y:0},this.offset={x:0,y:0},this.scale={x:1,y:1};for(var c in b)b.hasOwnProperty(c)&&(d.log("Adding property "+c+" to Sprite object with with value "+JSON.stringify(b[c])+"."),this[c]=b[c]);return Object.defineProperty(this,"center",{get:function(){return{x:this.width/2,y:this.height/2}}.bind(this)}),this.nudeTop=0,this.nudeLeft=0,this.nudeRight=this.nudeLeft+this.width,this.nudeBottom=this.nudeTop+this.height,this.nudeTopLeft=[this.nudeLeft,this.nudeTop],this.nudeTopRight=[this.nudeRight,this.nudeTop],this.nudeBottomLeft=[this.nudeLeft,this.nudeBottom],this.nudeBottomRight=[this.nudeRight,this.nudeBottom],this.nudeVertices=[this.nudeTopLeft,this.nudeTopRight,this.nudeBottomRight,this.nudeBottomLeft],this.vertices=new Array(this.nudeVertices.length),this.rotationAccel=0,this.accelDirection=0,this.nextX=this.x,this.nextY=this.y,this.nextSpeedX=this.speedX,this.nextSpeedY=this.speedY,this.wrapX=!0,this.wrapY=!1,this.boundingType="rect",this.blendMode="",this.onClick=function(){},this.currentAnimation="idle",this.currentFrame=0,this.animationTimer,this.updateCommands={},this.drawCommands={},this.gravity=0,this.g=1e3,this.direction=-Math.PI/2,this.v=0,this.y0=500-this.y,this.energy=this.y0,this.time=0,this.bounces=0,this.landingTime=(this.v*Math.sin(this.direction)+Math.sqrt(Math.pow(this.v*Math.sin(this.direction),2)+2*this.g*this.y0))/this.g,this
},d.objects.Sprite.prototype.x=0,d.objects.Sprite.prototype.y=0,d.objects.Sprite.prototype.z=0,d.objects.Sprite.prototype.width=0,d.objects.Sprite.prototype.height=0,d.objects.Sprite.prototype.angle=0,d.objects.Sprite.prototype.rotation=0,d.objects.Sprite.prototype.alpha=1,d.objects.Sprite.prototype.speedX=0,d.objects.Sprite.prototype.speedY=0,d.objects.Sprite.prototype.accelX=0,d.objects.Sprite.prototype.accelY=0,d.objects.Sprite.prototype.visible=!0,d.objects.Sprite.prototype.isClickable=!0,d.objects.Sprite.prototype.setHandle=function(a,b){return this.handle={x:a,y:b},this},d.objects.Sprite.prototype.setHandleXY=d.objects.Sprite.prototype.setHandle,d.objects.Sprite.prototype.setScale=function(a){return this.scale={x:a,y:a},this},d.objects.Sprite.prototype.multiplyScale=function(a){return this.scale={x:a*this.scale.x,y:a*this.scale.y},this},d.objects.Sprite.prototype.flipHorizontal=function(){return this.scale.x*=-1,this},d.objects.Sprite.prototype.flipVertical=function(){return this.scale.y*=-1,this},d.objects.Sprite.prototype.getX=function(){return this.x+this.offset.x},d.objects.Sprite.prototype.getY=function(){return this.y+this.offset.y},d.objects.Sprite.prototype.getScreenX=function(){var a=d.system.currentScene;return this.x+this.offset.x-a.camera.x*a.activeLayer.scrollRateX},d.objects.Sprite.prototype.getScreenY=function(){var a=d.system.currentScene;return this.y+this.offset.y-a.camera.y*a.activeLayer.scrollRateY},d.objects.Sprite.prototype.autoDraw=function(a){if(this.visible&&!(this.alpha<=0)){var b=this.angle,c=this.getScreenX(),d=this.getScreenY(),e=this.scale,f=this.texture;return a.globalAlpha=this.alpha,a.save(),a.translate(c,d),a.scale(e.x,e.y),a.rotate(-b),a.drawImage(f,-this.handle.x,-this.handle.y),a.restore(),this}},d.objects.Sprite.prototype.draw=d.objects.Sprite.prototype.autoDraw,d.objects.Sprite.prototype.autoDrawCustom=function(a,b){a.globalAlpha=b&&void 0!==b.opacity?b.opacity:this.alpha,this.alpha>0&&this.visible&&(0!==this.angle?(a.save(),a.translate(this.x,this.y),a.rotate(-this.angle),a.drawImage(b&&void 0!==b.texture?b.texture:this.animations.idle[this.currentFrame].img,-this.handle.x,-this.handle.y),a.restore()):a.drawImage(b&&void 0!==b.texture?b.texture:this.animations.idle[this.currentFrame].img,this.x-this.handle.x,this.y-this.handle.y))},d.objects.Sprite.prototype.drawBoundingBox=function(a,b,c){a.beginPath(),this.getVertices(),a.moveTo(this.vertices[3][0],this.vertices[3][1]);for(var d=0;4>d;d++)a.lineTo(this.vertices[d][0],this.vertices[d][1]);return a.closePath(),a.strokeStyle=b||"#FFFFFF",a.lineWidth=c||2,a.stroke(),this},d.objects.Sprite.prototype.autoUpdate=function(a){var b=d.system.timeScale;this.speedX+=this.accelX*a*b,this.speedY+=this.accelY*a*b,this.x+=this.speedX*a*b,this.y+=this.speedY*a*b,this.rotation+=this.rotationAccel*a*b,this.angle+=this.rotation*a*b},d.objects.Sprite.prototype.handleClick=function(a,b,c){if(this.isClickable){var d=this.scale,e=this.getScreenX(),f=this.getScreenY();if(0===this.angle){var g=e-d.x*this.handle.x,h=g+d.x*this.width,i=f-d.y*this.handle.y,j=i+d.y*this.height;if(g>h){var k=g;g=h,h=k}if(i>j){var k=i;i=j,j=k}if(a>=g&&h>=a&&b>=i&&j>=b&&this.isClickedPrecise(a,b)&&("mousedown"===c.type||"touchstart"===c.type))return this.onClick(a,b,c),!0}else if(0!==this.angle&&Math.jordanCurve(a,b,this.getVertices())&&this.isClickedPrecise(a,b)&&("mousedown"===c.type||"touchstart"===c.type))return this.onClick(a,b,c),!0}},d.objects.Sprite.prototype.isClickedPrecise=function(a,b){var c=d.system.pixelContext[0];c.clearRect(-1,-1,3,3),c.save(),c.translate(-a,-b),this.autoDraw(c),c.restore();var e=c.getImageData(0,0,1,1).data;return 0!==e[3]},d.objects.Sprite.prototype.getSpeedX=function(){return Math.vectorX(this.speed,this.direction)},d.objects.Sprite.prototype.getSpeedY=function(){return Math.vectorY(this.speed,this.direction)},d.objects.Sprite.prototype.applyForce=function(a,b){var c=this.getSpeedX(),d=this.getSpeedY(),e=Math.vectorX(a,b),f=Math.vectorY(a,b),g=c+e,h=d+f,i=Math.pow(Math.pow(g,2)+Math.pow(h,2),.5),j=Math.radToDeg(Math.atan2(-h,g));this.direction=j,this.speed=i},d.objects.Sprite.prototype.moveTo=function(a){this.x=a.x,this.y=a.y},d.objects.Sprite.prototype.moveToX=function(a){this.x=a},d.objects.Sprite.prototype.move=function(a){this.x+=a.x,this.y+=a.y},d.objects.Sprite.prototype.moveX=function(a){this.move({x:a,y:0})},d.objects.Sprite.prototype.moveY=function(a){this.move({x:0,y:a})},d.objects.Sprite.prototype.centerHandle=function(){this.handle={x:this.center.x,y:this.center.y}},d.objects.Sprite.prototype.pushProperties=function(a,b){for(var c=b.length,d=0;c>d;d++)a[b[d]]=this[b[d]]},d.objects.Sprite.prototype.pushPosition=function(a){a.x=this.x,a.y=this.y,a.offset={x:this.offset.x,y:this.offset.y}},d.objects.Sprite.prototype.getVertices=function(){var a=window.Math,b=this.getScreenX()+this.offset.x,c=this.getScreenY()+this.offset.y,d=this.nudeVertices.length,e=this.angle,f=this.scale;if(0!==e)for(var g=0;d>g;g++)this.vertices[g]=[(this.nudeVertices[g][0]-this.handle.x)*a.cos(-e)-(this.nudeVertices[g][1]-this.handle.y)*a.sin(-e),(this.nudeVertices[g][0]-this.handle.x)*a.sin(-e)+(this.nudeVertices[g][1]-this.handle.y)*a.cos(-e)];else for(var g=0;d>g;g++)this.vertices[g]=[this.nudeVertices[g][0]-this.handle.x,this.nudeVertices[g][1]-this.handle.y];return this.vertices.mapQuick(function(a){a[0]=a[0]*f.x+b,a[1]=a[1]*f.y+c}),this.vertices},d.Frame=function(a,b){this.img=d.texture[a],this.length=b},d.Animation=function(){},d.objects.Sprite.prototype.experimentalUpdate=function(a){var b=b;this.time+=a*b.system.timeScale;var c=c;this.time>=this.landingTime&&(this.energy<1&&(this.energy=0),this.direction=c.PI/2,this.y0=0,this.v=c.sqrt(2*this.g*this.energy/c.pow(c.sin(this.direction),2)),this.time-=this.landingTime,this.landingTime=(this.v*c.sin(this.direction)+c.sqrt(c.pow(this.v*c.sin(this.direction),2)+2*this.g*this.y0))/this.g),this.y=this.landingTime<a*b.system.timeScale?500:500-this.y0-(this.v*c.sin(this.direction)*this.time-this.g*this.time*this.time/2),this.y>=500&&(this.y=500),this.nextY=this.y,this.nextSpeedX+=this.accelX*a*b.system.timeScale,this.nextX+=this.nextSpeedX*b.system.dt*b.system.timeScale,this.nextX>=800&&(this.nextSpeedX=-this.speedX,this.speedX=-this.speedX,this.nextX=799),this.nextX<=49&&(this.nextSpeedX=-this.speedX,this.speedX=-this.speedX,this.nextX=50),this.x=this.nextX,this.speedX=this.nextSpeedX},d.objects.Layer=function(a){this.name=a,this.sorted=!1,this.sortBy=["z"],this.sortOrder=[1],this.objects=[],this.targetContext=d.system.bufferContext[0],this.layerAlpha=1,this.isClickable=!0,this.scrollRateX=1,this.scrollRateY=1,this.visible=!0,this.updating=!0},d.objects.Layer.prototype.autoDraw=function(a){if(this.visible)for(var b=this.objects,c=b.length,d={},e=0;c>e;e++)d=b[e],d&&d.draw&&d.draw(this.targetContext,a)},d.objects.Layer.prototype.draw=d.objects.Layer.prototype.autoDraw,d.objects.Layer.prototype.autoUpdate=function(a){if(this.updating&&(this.objects.update(a),this.sorted))for(var b=this.sortBy.length,c=0;b>c;c++)this.objects.sortBy(this.sortBy[c],this.sortOrder[c])},d.objects.Layer.prototype.update=d.objects.Layer.prototype.autoUpdate,d.objects.Layer.prototype.handleClick=function(a,b,c){this.isClickable&&this.objects.handleClick(a,b,c)},d.objects.Layer.prototype.addObject=function(a){this.objects.push(a)},d.objects.Layer.prototype.addObjects=function(){for(var a=arguments.length,b=0;a>b;b++)this.addObject(arguments[b])},d.objects.Scene=function(a){this.name=a,d.scenes[a]=this,this.layers={background:new d.objects.Layer("background")},this.layerOrder=["background"],this.bgFill="blueviolet",this.alpha=1,this.keymap=new d.keyboard.Keymap,this.activeLayer={},this.camera={x:0,y:0,angle:0,zoom:1}},d.objects.Scene.prototype.doKeyDown=function(a){void 0!==this.keymap.doKeyDown&&this.keymap.doKeyDown(a)},d.objects.Scene.prototype.doKeyUp=function(a){void 0!==this.keymap.doKeyUp&&this.keymap.doKeyUp(a)},d.objects.Scene.prototype.autoUpdate=function(a){for(var b=this.layerOrder,c=b.length,d=0;c>d;d++){var e=this.layers[b[d]];this.activeLayer=e,e.update(a)}return this},d.objects.Scene.prototype.update=d.objects.Scene.prototype.autoUpdate,d.objects.Scene.prototype.autoDraw=function(){var a=d.system,b=a.bufferContext[0],c=a.renderContext[0],e=a.width,f=a.height;b.fillStyle!==this.bgFill&&(b.fillStyle=this.bgFill),b.fillRect(0,0,e,f);for(var g=this.layerOrder,h=g.length,i=0;h>i;i++){var j=this.layers[g[i]];this.activeLayer=j,j.draw(this.camera)}1!==b.globalAlpha&&(b.globalAlpha=1),c.globalAlpha!==this.alpha&&(c.globalAlpha=this.alpha),c.drawImage(a.bufferCanvas[0],0,0,e,f)},d.objects.Scene.prototype.draw=d.objects.Scene.prototype.autoDraw,d.objects.Scene.prototype.newLayer=function(a){var b=new d.objects.Layer(a);return this.layers[a]=b,this.layerOrder.push(a),b},d.objects.Scene.prototype.addLayer=d.objects.Scene.prototype.newLayer,d.objects.Scene.prototype.addLayerObject=function(a){this.layers[a.name]=a,this.layerOrder.push(a.name)},d.objects.Scene.prototype.addObjectToLayer=function(a,b){return this.layers[b].addObject(a),this},d.objects.Scene.prototype.handleClick=function(a,b,c){for(var d=this.layerOrder,e=d.length,f=0;e>f;f++){var g=this.layers[d[f]];this.activeLayer=g,g.handleClick(a,b,c)}},d.objects.Scene.prototype.transition={},d.objects.Scene.prototype.transition.fadeToColor=function(a,b,c,e,f,g){d.transitions.fadeToColor.play(d.system.currentScene,a,b,c,e,f,g)},d.objects.Scene.prototype.transition.fadeToBlack=function(a,b,c,e,f){d.transitions.fadeToColor.play(d.system.currentScene,a,b,c,e,"#000000",f)},d.objects.Scene.prototype.transition.instant=function(a,b){d.transitions.instant.play(d.system.currentScene,a,b)},d.objects.Scene.prototype.setScene=function(){var a=d.system;return a.previousScene=a.currentScene,a.nextScene=this,this},d.objects.Textbox=function(a,b,c,d,e){this.width=void 0===d?200:d,this.height=e,this.words=void 0===a?[]:a.split(" "),this.textArray=[],Object.defineProperty(this,"text",{set:function(a){this.words=a.split(" "),this.wrapText()}.bind(this),get:function(){return this.words.join(" ")}.bind(this)}),this.x=void 0===b?0:b,this.y=void 0===c?0:c,this.alpha=1,this.font="Times",this.fontSize=30,this.lineSpacing=1,this.handle={},this.handle.x=0,this.handle.y=0,this.angle=0,this.scale=1,this.speedX=0,this.speedY=0,this.accelX=0,this.accelY=0,this.rotation=0,this.textFill="#000000",this.textStrokeStyle="",this.textLineWidth="2",this.wrap=!0,this.alignment="left",this.alignmentY="top",this.backgroundFill="#FFFFFF",this.borderFill="",this.borderWidth=0,this.marginLeft=5,this.marginTop=5,this.marginRight=5,this.marginBottom=5,this.visible=!0,this.isClickable=!0},d.objects.Textbox.prototype.draw=function(a){this.autoDraw(a)},d.objects.Textbox.prototype.autoDraw=function(a){if(this.visible){a.globalAlpha=this.alpha;var b=""!==this.backgroundFill&&this.borderWodth>0;a.textAlign="left",a.font=this.fontSize+"px "+this.font,this.height||(this.height=this.fontSize);var c=this.textArray.length;if(0!==this.angle){var d=this.angle;a.save(),a.translate(this.x,this.y),a.rotate(-d),b&&(a.beginPath(),a.rect(-this.handle.x,-this.handle.y,this.width+this.marginLeft+this.marginRight,this.height+this.marginTop+this.marginBottom+this.fontSize*(c-1)*this.lineSpacing),""!==this.backgroundFill&&(a.fillStyle=this.backgroundFill,a.fill()),this.borderWidth>0&&(a.strokeStyle=this.borderFill,a.lineWidth=this.borderWidth,a.stroke())),a.fillStyle=this.textFill,a.textBaseline="bottom";for(var e=0;c>e;e++){var f=this.textArray[e],g=this.marginLeft-this.handle.x,h=this.marginTop+this.fontSize-this.handle.y+this.fontSize*e*this.lineSpacing;1!==this.scale&&(a.save(),a.translate(this.x,this.y),a.scale(this.scale,this.scale),a.translate(-this.x,-this.y)),""!==this.textStrokeStyle&&(a.lineWidth=this.textLineWidth,a.strokeStyle=this.textStrokeStyle,a.strokeText(f,g,h)),a.fillText(f,g,h),1!==this.scale&&a.restore()}a.restore()}else{b&&(a.beginPath(),a.rect(this.x-this.handle.x,this.y-this.handle.y,this.width+this.marginLeft+this.marginRight,this.height+this.marginTop+this.marginBottom+this.fontSize*(c-1)*this.lineSpacing),""!==this.backgroundFill&&(a.fillStyle=this.backgroundFill,a.fill()),this.borderWidth>0&&(a.strokeStyle=this.borderFill,a.lineWidth=this.borderWidth,a.stroke())),a.fillStyle=this.textFill,a.textBaseline="bottom";for(var e=0;c>e;e++){var f=this.textArray[e],g=this.x+this.marginLeft-this.handle.x,h=this.y+this.marginTop+this.fontSize-this.handle.y+this.fontSize*e*this.lineSpacing;1!==this.scale&&(a.save(),a.translate(this.x,this.y),a.scale(this.scale,this.scale),a.translate(-this.x,-this.y)),""!==this.textStrokeStyle&&(a.lineWidth=this.textLineWidth,a.strokeStyle=this.textStrokeStyle,a.strokeText(f,g,h)),a.fillText(f,g,h),1!==this.scale&&a.restore()}}}},d.objects.Textbox.prototype.update=function(a){this.autoUpdate(a)},d.objects.Textbox.prototype.autoUpdate=function(){},d.objects.Textbox.prototype.autoSize=function(){this.autoSizeX(),this.autoSizeY(),this.wrapText()},d.objects.Textbox.prototype.autoSizeX=function(){this.width=this.getTextWidth(),this.realign()},d.objects.Textbox.prototype.autoSizeY=function(){this.height=this.fontSize},d.objects.Textbox.prototype.wrapText=function(){var a=this.words.length;this.textArray=[];for(var b=0,c="",d=this.width,e=0;a>e;e++){var f=this.getTextWidth(c);0===f?c=this.words[e]:this.getTextWidth(c+" "+this.words[e])<=d?c+=" "+this.words[e]:(this.textArray[b]=c,b++,c=this.words[e])}this.textArray[b]=c},d.objects.Textbox.prototype.getTextWidth=function(a){var b=d.system.bufferContext[0];if(b.font=this.fontSize+"px "+this.font,""===a)return 0;var c=b.measureText(a?a:this.text);return c.width},d.objects.Textbox.prototype.getTotalWidth=function(){return this.width+this.marginLeft+this.marginRight},d.objects.Textbox.prototype.getTotalHeight=function(){return this.height+this.marginTop+this.marginBottom},d.objects.Textbox.prototype.realign=function(){this[this.alignment](),this[this.alignmentY]()},d.objects.Textbox.prototype.center=function(){return this.handle.x=this.getTotalWidth()/2,this.alignment="center",this},d.objects.Textbox.prototype.centerY=function(){return this.handle.y=this.getTotalHeight()/2,this.alignmentY="centerY",this},d.objects.Textbox.prototype.top=function(){return this.handle.y=0,this.alignmentY="top",this},d.objects.Textbox.prototype.bottom=function(){return this.handle.y=this.getTotalHeight(),this.alignmentY="bottom",this},d.objects.Textbox.prototype.left=function(){return this.handle.x=0,this.alignment="left",this},d.objects.Textbox.prototype.right=function(){return this.handle.x=this.getTotalWidth(),this.alignment="right",this},d.objects.Textbox.prototype.setMargins=function(){switch(arguments.length){case 1:this.marginLeft=this.marginTop=this.marginRight=this.marginBottom=arguments[0];break;case 2:this.marginTop=this.marginBottom=arguments[0],this.marginLeft=this.marginRight=arguments[1];break;case 3:this.marginTop=arguments[0],this.marginRight=this.marginLeft=arguments[1],this.marginBottom=arguments[2];break;case 4:this.marginTop=arguments[0],this.marginRight=arguments[1],this.marginBottom=arguments[2],this.marginLeft=arguments[3];break;default:alert("Textbox.setMargins() called with wrong number of arguments.")}return this.realign(),this},d.objects.Textbox.prototype.handleClick=function(a,b,c){return this.isClickable&&(0===this.angle&&a>=this.x-this.handle.x&&a<=this.x+this.width+this.marginLeft+this.marginRight-this.handle.x&&b>=this.y-this.handle.y&&b<=this.y+this.height+this.marginTop+this.marginBottom-this.handle.y+this.fontSize*(this.textArray.length-1)*this.lineSpacing||0!==this.angle&&Math.jordanCurve(a,b,this.getVertices()))&&("mousedown"===c.type||"touchstart"===c.type)?(this.onClick(a,b,c),!0):void 0},d.objects.Textbox.prototype.getVertices=function(){var a=window.Math,b=this.x,c=this.y,d=this.scale,e=0-this.handle.y,f=0-this.handle.x,g=f+this.width+this.marginLeft+this.marginRight,h=e+this.height+this.marginTop+this.marginBottom+this.fontSize*(this.textArray.length-1)*this.lineSpacing,i=[[f,e],[g,e],[g,h],[f,h]];if(1!==this.scale&&i.mapQuick(function(a){a[0]*=d,a[1]*=d}),0!==this.angle)for(var j=i.length,k=0;j>k;k++)i[k]=[i[k][0]*a.cos(-this.angle)-i[k][1]*a.sin(-this.angle),i[k][0]*a.sin(-this.angle)+i[k][1]*a.cos(-this.angle)];return i.mapQuick(function(a){a[0]+=b,a[1]+=c}),i},d.transitions={},d.transitions.instant={},d.transitions.instant.play=function(a,b,c){a.exit&&a.exit(),c&&c(b),d.system.currentScene=b},d.transitions.fadeToColor={lastScene:{},nextScreen:{},timer:0,state:"start"},d.transitions.fadeToColor.play=function(a,b,c,e,f,g,h){this.lastScene=a,this.nextScene=b,this.camera=a.camera,this.currentScene=a,this.activeLayer=a.activeLayer,this.fadeOut=c,this.pause=e,this.fadeIn=f,this.timer=c,this.state="start",this.color=g||"#000000",this.callback=h||function(){},d.system.currentScene=this},d.transitions.fadeToColor.update=function(a){switch(this.state){case"start":this.timer=this.fadeOut,this.lastScene.update(a),this.state="fadeOut";break;case"fadeOut":this.timer-=a,this.lastScene.update(a),this.timer<=0&&(this.timer=this.pause,this.callback(this.nextScene),this.state="pause");break;case"pause":this.timer-=a,this.timer<=0&&(this.camera=this.nextScene.camera,this.timer=this.fadeIn,this.state="fadeIn");break;case"fadeIn":this.timer-=a,this.nextScene.update(a),this.timer<=0&&(d.system.currentScene=this.nextScene);break;default:alert("Hey!")}},d.transitions.fadeToColor.draw=function(){switch(this.state){case"start":case"fadeOut":this.lastScene.draw(),d.system.renderContext[0].fillStyle=this.color,d.system.renderContext[0].globalAlpha=1-this.timer/this.fadeOut,d.system.renderContext[0].fillRect(0,0,d.system.width,d.system.height);break;case"pause":d.system.renderContext[0].fillStyle=this.color,d.system.renderContext[0].globalAlpha=1,d.system.renderContext[0].fillRect(0,0,d.system.width,d.system.height);break;case"fadeIn":this.nextScene.draw(),d.system.renderContext[0].fillStyle=this.color,d.system.renderContext[0].globalAlpha=this.timer/this.fadeIn,d.system.renderContext[0].fillRect(0,0,d.system.width,d.system.height);break;default:alert("hey!")}},d.keyboard={},d.input=d.keyboard,d.keyboard.keyCodeFromString=function(a){var b=a.toUpperCase().replace(" ","");if(b.match(/^[A-Z0-9]$/))return b.charCodeAt(0);if(0===b.indexOf("NUMPAD"))return 96+parseInt(b.charAt(b.length-1));if(0===b.indexOf("F"))return 111+parseInt(b.replace("F",""));switch(b){case"ANY":case"ALL":return 0;case"MULTIPLY":return 106;case"ADD":return 107;case"ENTER":return 13;case"SUBTRACT":return 109;case"DECIMAL":return 110;case"DIVIDE":return 111;case"BACKSPACE":case"BACK":return 8;case"TAB":return 9;case"SHIFT":return 16;case"CONTROL":case"CTRL":return 17;case"CAPS":case"CAPSLOCK":return 20;case"ESC":case"ESCAPE":return 27;case"SPACE":case"SPACEBAR":return 32;case"PGUP":case"PAGEUP":return 33;case"PGDN":case"PAGEDOWN":return 34;case"END":return 35;case"HOME":return 36;case"LEFT":case"LEFTARROW":return 37;case"UP":case"UPARROW":return 38;case"RIGHT":case"RIGHTARROW":return 39;case"DOWN":case"DOWNARROW":return 40;case"INSERT":return 45;case"DELETE":return 46;case"NUMLOCK":return 144;case"SCRLK":case"SCROLLLOCK":return 145;case"PAUSE":case"PAUSEBREAK":return 19;case";":case":":return 186;case"=":case"+":return 187;case"-":case"_":return 198;case"/":case"?":return 191;case"~":case"`":return 192;case"[":case"{":return 219;case"\\":case"|":case"BACKSLASH":return 220;case"]":case"}":return 221;case"'":case'"':case"QUOTE":case"QUOTES":return 222;case",":case"<":return 188;case".":case">":return 190;default:alert("'"+a+"' is not a valid key identifier.")}},d.keyboard.state=[],d.keyboard.isKeyDown=function(a){var b=d.keyboard,c=b.keyCodeFromString(a);return-1!==b.state.indexOf(c)},d.keyboard.reset=function(){return d.keyboard.state.length=0,this},d.keyboard.Keymap=function(){return this.bindings={},this},d.keyboard.Keymap.prototype.doKeyDown=function(a){var b=a.keyCode,c=this.bindings,e=d.keyboard;-1===e.state.indexOf(b)&&e.state.push(b),c[b]&&c[b].keydown?c[b].keydown():c[0]&&c[0].keydown&&c[0].keydown()},d.keyboard.Keymap.prototype.doKeyUp=function(a){var b=a.keyCode,c=this.bindings,e=d.keyboard,f=e.state.indexOf(b);-1!==f&&e.state.splice(f,1),c[b]&&c[b].keyup?c[b].keyup():c[0]&&c[0].keyup&&c[0].keyup()},d.keyboard.Keymap.prototype.bindKey=function(a,b,c){return this.bindKeyCode(d.input.keyCodeFromString(a),b,c),this},d.keyboard.Keymap.prototype.bindKeyCode=function(a,b,c){return this.bindings[a]||(this.bindings[a]={}),this.bindings[a][b.toLowerCase()]=c,this},d.objects.Bone=function(a,b){d.objects.Sprite.call(this,a,b),this.inheritPosition=!0,this.inheritAngle=!0,this.inheritScale=!0,this.joint={x:0,y:0},this.relAngle=0,this.children=[]},d.objects.Bone.prototype=new d.objects.Sprite,d.objects.Bone.constructor=d.objects.Bone,d.objects.Bone.prototype.draw=function(a){this.autoDraw(a)},d.objects.Bone.prototype.updateBone=function(a){var b=this.parent;if(this.inheritScale){var c=b.scale;this.scale={x:c.x,y:c.y}}if(this.inheritPosition){var d=b.x,e=b.y,f=this.parent.scale,g=this.joint.x-b.handle.x,h=this.joint.y-b.handle.y;if(0===b.angle)this.x=d+f.x*(this.joint.x-b.handle.x),this.y=e+f.y*(this.joint.y-b.handle.y);else{var i=Math.rotatePoint(g,h,this.parent.angle);this.x=i.x*f.x+d,this.y=i.y*f.y+e}}this.inheritAngle&&(this.angle=this.relAngle+b.angle);for(var j=this.children.length,k=0;j>k;k++)this.children[k].updateBone(a),this.children[k].update(a)},d.objects.Skeleton=function(a,b){d.objects.Sprite.call(this,a,b),this.children=[],this.bones={},this.drawOrder=[this]},d.objects.Skeleton.prototype=new d.objects.Sprite,d.objects.Skeleton.constructor=d.objects.Skeleton,d.objects.Skeleton.prototype.handleClick=function(a,b,c){for(var e=this.drawOrder.length,f=e-1;f>=0;f--){var g,h=this.drawOrder[f];if(g=this!==h?h.handleClick(a,b,c):d.objects.Sprite.prototype.handleClick.call(this.drawOrder[f],a,b,c))return!0}},d.objects.Skeleton.prototype.addBone=function(a,b){var c=new d.objects.Bone(a);return c.name=b,c.master=this,c.parent=this,this.children.push(c),this.bones[b]=c,this.drawOrder.push(c),c},d.objects.Bone.prototype.addBone=function(a,b){var c=new d.objects.Bone(a);return c.name=b,c.master=this.master,c.parent=this,this.children.push(c),this.master.bones[b]=c,this.master.drawOrder.push(c),c},d.objects.Skeleton.prototype.draw=function(a){for(var b=this.drawOrder.length,c=0;b>c;c++){var d=this.drawOrder[c];this===d?(this.autoDraw(a),this.drawBoundingBox(a)):this.drawOrder[c].draw(a)}},d.objects.Skeleton.prototype.update=function(a){this.updateBones(a)},d.objects.Skeleton.prototype.updateBones=function(a){for(var b=this.children.length,c=0;b>c;c++){var d=this.children[c];d.updateBone(a),d.update(a)}},d.objects.Timeline=function(){this.paused=!0,this.timer=0,this.length=0,this.eventList=[],this.nextEvent=0,this.preserveEvents=!0,this.stopAfterEvent=0,this.stopAtTime=0},d.objects.Timeline.prototype.update=function(a){if(!this.paused){var b=this.eventList.length;for(this.timer+=a;this.nextEvent<b&&this.timer>=this.eventList[this.nextEvent][0];)this.eventList[this.nextEvent][1](),this.nextEvent++,0!==this.stopAfterEvent&&this.nextEvent>this.stopAfterEvent-1&&(this.paused=!0)}},d.objects.Timeline.prototype.addEvent=function(a,b){var c=this.eventList,d=this.eventList.length;if(0===d||c[d-1][0]<=a)return c.push([a,b]),this;for(var e=d-1;e>=0;e--){if(0===e)return c.unshift([a,b]),this;if(a<c[e][0]&&a>=c[e-1][0])return c.splice(e,0,[a,b]),this}},d.objects.Timeline.prototype.play=function(){this.paused=!1},d.objects.Timeline.prototype.pause=function(){this.paused=!0},d.objects.Timeline.prototype.togglePause=function(){this.paused=!this.paused},d.objects.Timeline.prototype.reset=function(){this.paused=!0,this.timer=0,this.nextEvent=0},d.objects.SpriteMask=function(a,b,c,e,f,g,h){this.red=b,this.green=c,this.blue=e;var i=this.sourceTexture=d.textures[a],j=this.width=void 0===g?i.width:g,k=this.height=void 0===h?i.height:h;(0===j||0===k)&&alert("Texture '"+i+"' does not seem to have any dimensions.");var l=this.texture=document.createElement("canvas");l.width=j,l.height=k;var m=this.ctx=l.getContext("2d");m.drawImage(i,0,0),this.imageData=this.ctx.getImageData(0,0,j,k),this.setColor(b,c,e,f)},d.objects.SpriteMask.prototype.saveAs=function(a){d.textures[a]=this.texture},d.objects.SpriteMask.prototype.setColor=function(a,b,c){var d=this.width,e=this.height;this.red=a,this.green=b,this.blue=c;for(var f=this.imageData,g=f.data.length,h=0;g>h;h+=4)f.data[h]=a,f.data[h+1]=b,f.data[h+2]=c;this.ctx.clearRect(-1,-1,d+1,e+1),this.ctx.putImageData(f,0,0)},d.objects.Triangle2D=function(a){this.x1=a[0][0],this.x2=a[1][0],this.x3=a[2][0],this.y1=a[0][1],this.y2=a[1][1],this.y3=a[2][1],this.stroke=!0,this.lineWidth=1,this.strokeStyle="#FF0000",this.fill=!1,this.fillStyle="#FFFFFF"},d.objects.Triangle2D.prototype.draw=function(a){a.beginPath(),a.moveTo(this.x1,this.y1),a.lineTo(this.x2,this.y2),a.lineTo(this.x3,this.y3),a.closePath(),this.stroke&&(this.lineWidth!==a.lineWidth&&(a.lineWidth=this.lineWidth),this.strokeStyle!==a.strokeStyle&&(a.strokeStyle=this.strokeStyle),a.stroke())},d.objects.Triangle2D.prototype.findIncenter=function(){},d.objects.Triangle2D.prototype.growBy=function(a,b){var c=Math.sqrt(Math.pow(this.x2-this.x3,2)+Math.pow(this.y2-this.y3,2)),d=Math.sqrt(Math.pow(this.x3-this.x1,2)+Math.pow(this.y3-this.y1,2)),e=Math.sqrt(Math.pow(this.x1-this.x2,2)+Math.pow(this.y1-this.y2,2)),f=Math.acos((d*d+e*e-c*c)/(2*d*e)),g=Math.acos((e*e+c*c-d*d)/(2*e*c)),h=Math.acos((c*c+d*d-e*e)/(2*c*d)),i=(this.x1*c+this.x2*d+this.x3*e)/(c+d+e),j=(this.y1*c+this.y2*d+this.y3*e)/(c+d+e),k=a/Math.sin(f/2),l=a/Math.sin(g/2),m=a/Math.sin(h/2),n=Math.sqrt(Math.pow(this.x1-i,2)+Math.pow(this.y1-j,2)),o=Math.sqrt(Math.pow(this.x2-i,2)+Math.pow(this.y2-j,2)),p=Math.sqrt(Math.pow(this.x3-i,2)+Math.pow(this.y3-j,2)),q=k/n,r=l/o,s=m/p;void 0===b?(this.x1=this.x1+(this.x1-i)*q,this.y1=this.y1+(this.y1-j)*q,this.x2=this.x2+(this.x2-i)*r,this.y2=this.y2+(this.y2-j)*r,this.x3=this.x3+(this.x3-i)*s,this.y3=this.y3+(this.y3-j)*s):(this.x1=this.x1+((this.x1-i)*q).clamp(-b,b),this.y1=this.y1+((this.y1-j)*q).clamp(-b,b),this.x2=this.x2+((this.x2-i)*r).clamp(-b,b),this.y2=this.y2+((this.y2-j)*r).clamp(-b,b),this.x3=this.x3+((this.x3-i)*s).clamp(-b,b),this.y3=this.y3+((this.y3-j)*s).clamp(-b,b))},d.objects.Point2D=function(a,b){this.x=a,this.y=b},d.objects.Point2D.prototype.distanceToPoint=function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},d.objects.Point2D.prototype.closestPoint=function(){},d.objects.Ray2D=function(a,b,c,d){this.xOrigin=a,this.yOrigin=b,this.range=d,this.slopeX=0,this.slopeY=0,this.yIntercept=0,this.setAngle(c),this.currentX=a,this.currentY=b},d.objects.Ray2D.prototype.setAngle=function(a){this.slopeX=Math.cos(-a),this.slopeY=Math.sin(-a),this.slope=Math.tan(-a),this.yIntercept=this.yOrigin-this.xOrigin*this.slope},d.objects.Ray2D.prototype.moveOrigin=function(a,b,c){this.xOrigin=this.currentX=a,this.yOrigin=this.currentY=b,this.setAngle(c)},d.objects.Ray2D.prototype.getYFromX=function(a){return this.slope*a+this.yIntercept},d.objects.Ray2D.prototype.getXFromY=function(a){return(a-this.yIntercept)/this.slope},d.objects.Ray2D.prototype.inspectPoint=function(a,b,c,d,e,f,g,h){if(0>a||0>b)return!1;var i=a|0-(c&&!e)?0:1,j=0|b;if(f[j]&&f[j][i]&&1===f[j][i]){var k=a-this.xOrigin,l=b-this.yOrigin,m=Math.sqrt(k*k+l*l);(!g[h]||g[h].distance>m)&&(g[h]={frame:this.frameCount,distance:m,adjustedDistance:m*Math.cos(this.angle),x:a,y:b})}},d.objects.Ray2D.prototype.findNextIntersection=function(a,b){for(this.xPositive=this.slopeX>=0?!0:!1,this.yPositive=this.slopeY>=0?!0:!1,this.resolved=!1;!this.resolved;){if(Math.abs(this.currentX-this.xOrigin)>b||Math.abs(this.currentY-this.yOrigin)>b){this.resolved=!0;break}if(this.xPositive)this.currentX<0&&(this.currentX=-1),this.nextVertX=this.currentX+1|0;else{if(this.currentX<0)return!1;this.nextVertX=(0|this.currentX)===this.currentX?this.currentX-1:0|this.currentX}if(this.nextVertY=this.getYFromX(this.nextVertX),this.yPositive)this.currentY<0&&(this.currentY=-1),this.nextHorY=this.currentY+1|0;else{if(this.currentY<0)return!1;this.nextHorY=(0|this.currentY)===this.currentY?this.currentY-1:0|this.currentY}if(this.nextHorX=this.getXFromY(this.nextHorY),this.dVertX=this.xOrigin-this.nextVertX,this.dVertY=this.yOrigin-this.nextVertY,this.dHorX=this.xOrigin-this.nextHorX,this.dHorY=this.yOrigin-this.nextHorY,this.dHorX*this.dHorX+this.dHorY*this.dHorY>=this.dVertX*this.dVertX+this.dVertY*this.dVertY?(this.currentX=this.nextVertX,this.currentY=this.nextVertY,this.vertical=!0):(this.currentX=this.nextHorX,this.currentY=this.nextHorY,this.vertical=!1),!(this.currentY<0||this.currentX<0)&&(this.gridX=!this.xPositive&&this.vertical?this.currentX-1|0:0|this.currentX,this.gridY=this.yPositive||this.vertical?0|this.currentY:this.currentY-1|0,a.grid[this.gridY]&&a.grid[this.gridY][this.gridX]&&0!==a.grid[this.gridY][this.gridX]))return this.resolved=!0,!0}return!1},d.objects.RayCastWindow=function(a){this.buffer=!1,this.bufferContext=!1,a&&(this.buffer=document.createElement("canvas"),this.bufferContext=this.buffer.getContext("2d")),this.x=0,this.y=0,this.width=600,this.height=300,this.relativeAngles=[],this.resolutionRatio=1,this.range=10,this.viewAngle=Math.PI/1.5,this.camera=new d.objects.Camera,this.setHorizontalResolution(600),this.arrayOfRays=[],this.rayObject=new d.objects.Ray2D(0,0,0),this.map={},this.map.type="simple",this.map.legend={1:"#ffffff"},this.map.grid=[[1,1,1,1,1,1,1,1,1,1,1],[1,1,0,1,0,1,0,0,0,1,1],[1,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,0,1,1],[1,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,0,1,1,1,0,1,1],[1,0,0,0,0,0,0,1,0,0,1],[1,1,0,1,0,1,0,1,0,1,1],[1,0,0,0,0,0,0,1,0,0,1],[1,1,0,1,0,1,0,1,0,1,1],[1,1,1,1,1,1,1,1,1,1,1]],this.camera.x=3.5,this.camera.y=4.5,this.camera.angle=0,this.frameCount=0},d.objects.RayCastWindow.prototype.setResolution=function(a){this.setHorizontalResolution(a),this.buffer&&(this.buffer.width=a)},d.objects.RayCastWindow.prototype.setHorizontalResolution=function(a){this.horizontalResolution=a;var b=this.viewAngle/2,c=-Math.tan(b)/2;alert(c);for(var d=0;a>d;d++){var e=Math.atan2(2*-c*d/a+c,1);this.relativeAngles.push(e)}},d.objects.RayCastWindow.prototype.update=function(){this.frameCount+=1;for(var a=this.camera.angle,b=this.camera.x,c=this.camera.y,d=this.horizontalResolution,e=0;d>e;e++){var f=this.relativeAngles[e],g=a-f;if(this.rayObject.moveOrigin(b,c,g),this.rayObject.findNextIntersection(this.map,20,this.arrayOfRays,e)){var h=b-this.rayObject.currentX,i=c-this.rayObject.currentY,j=Math.sqrt(h*h+i*i);this.arrayOfRays[e]={frame:this.frameCount,distance:j,adjustedDistance:j*Math.cos(f),x:this.rayObject.currentX,y:this.rayObject.currentY}}else this.arrayOfRays[e]=0}},d.objects.RayCastWindow.prototype.drawDebugMap=function(a,b,c,d,e,f){a.fillStyle="#ffffff",a.fillRect(b,c,this.map.grid[0].length*f,this.map.grid.length*f);for(var g=0;g<this.map.grid.length;g++)for(var h=0;h<this.map.grid[0].length;h++)1===this.map.grid[g][h]&&(a.fillStyle="#000000",a.fillRect(h*f,g*f,f,f));a.fillStyle="#FF0000",a.beginPath(),a.arc(this.camera.x*f,this.camera.y*f,2.5,0,2*Math.PI),a.fill(),a.closePath();var i=this.arrayOfRays.length;a.strokeStyle="#00FF00";for(var j=0;i>j;j++)if(void 0!==this.arrayOfRays[j]&&this.arrayOfRays[j].frame===this.frameCount){{var k=this.arrayOfRays[j];this.camera.angle-this.relativeAngles[j],k.distance}a.beginPath(),a.moveTo(this.camera.x*f,this.camera.y*f),a.lineTo(k.x*f,k.y*f),a.closePath(),a.stroke()}},d.objects.RayCastWindow.prototype.draw=function(a){a.fillStyle="#003366",a.fillRect(0,0,this.width,this.height/2);for(var b,c=this.arrayOfRays.length,d=this.width/this.horizontalResolution,e=0;c>e;e++)if(void 0!==this.arrayOfRays[e]&&this.arrayOfRays[e].frame===this.frameCount){var b=this.arrayOfRays[e],f=b.distance,g=this.height/2*1/b.adjustedDistance,h=1/(f+1)*2*255|0,i="rgb("+h+","+h+","+h+")";a.fillStyle=i,a.fillRect(e*d,150-g/2,d,g)
}this.drawDebugMap(a,0,0,0,0,10)},d.objects.Rectangle=function(a,b,c){this.width=a,this.height=b,this.fillstyle="",this.lineWidth=2,this.strokeStyle="",this.handle={x:0,y:0},this.offset={x:0,y:0},this.scale={x:1,y:1};for(var e in c)c.hasOwnProperty(e)&&(d.log("Adding property "+e+" to Rectangle object with with value "+JSON.stringify(c[e])+"."),this[e]=c[e]);return Object.defineProperty(this,"center",{get:function(){return{x:this.width/2,y:this.height/2}}.bind(this)}),this.nudeTop=0,this.nudeLeft=0,this.nudeRight=this.nudeLeft+this.width,this.nudeBottom=this.nudeTop+this.height,this.nudeTopLeft=[this.nudeLeft,this.nudeTop],this.nudeTopRight=[this.nudeRight,this.nudeTop],this.nudeBottomLeft=[this.nudeLeft,this.nudeBottom],this.nudeBottomRight=[this.nudeRight,this.nudeBottom],this.nudeVertices=[this.nudeTopLeft,this.nudeTopRight,this.nudeBottomRight,this.nudeBottomLeft],this.vertices=new Array(this.nudeVertices.length),this.rotationAccel=0,this.accelDirection=0,this.nextX=this.x,this.nextY=this.y,this.nextSpeedX=this.speedX,this.nextSpeedY=this.speedY,this.wrapX=!0,this.wrapY=!1,this.boundingType="rect",this.blendMode="",this.onClick=function(){},this.currentAnimation="idle",this.currentFrame=0,this.animationTimer,this.updateCommands={},this.drawCommands={},this.gravity=0,this.g=1e3,this.direction=-Math.PI/2,this.v=0,this.y0=500-this.y,this.energy=this.y0,this.time=0,this.bounces=0,this.landingTime=(this.v*Math.sin(this.direction)+Math.sqrt(Math.pow(this.v*Math.sin(this.direction),2)+2*this.g*this.y0))/this.g,this},d.objects.Rectangle.prototype.x=0,d.objects.Rectangle.prototype.y=0,d.objects.Rectangle.prototype.z=0,d.objects.Rectangle.prototype.width=0,d.objects.Rectangle.prototype.height=0,d.objects.Rectangle.prototype.angle=0,d.objects.Rectangle.prototype.rotation=0,d.objects.Rectangle.prototype.alpha=1,d.objects.Rectangle.prototype.speedX=0,d.objects.Rectangle.prototype.speedY=0,d.objects.Rectangle.prototype.accelX=0,d.objects.Rectangle.prototype.accelY=0,d.objects.Rectangle.prototype.visible=!0,d.objects.Rectangle.prototype.isClickable=!0,d.objects.Rectangle.prototype.setHandle=function(a,b){return this.handle={x:a,y:b},this},d.objects.Rectangle.prototype.setHandleXY=d.objects.Rectangle.prototype.setHandle,d.objects.Rectangle.prototype.setScale=function(a){return this.scale={x:a,y:a},this},d.objects.Rectangle.prototype.multiplyScale=function(a){return this.scale={x:a*this.scale.x,y:a*this.scale.y},this},d.objects.Rectangle.prototype.flipHorizontal=function(){return this.scale.x*=-1,this},d.objects.Rectangle.prototype.flipVertical=function(){return this.scale.y*=-1,this},d.objects.Rectangle.prototype.getX=function(){return this.x+this.offset.x},d.objects.Rectangle.prototype.getY=function(){return this.y+this.offset.y},d.objects.Rectangle.prototype.getScreenX=function(){var a=d.system.currentScene;return this.x+this.offset.x-a.camera.x*a.activeLayer.scrollRateX},d.objects.Rectangle.prototype.getScreenY=function(){var a=d.system.currentScene;return this.y+this.offset.y-a.camera.y*a.activeLayer.scrollRateY},d.objects.Rectangle.prototype.autoDraw=function(a){if(this.visible&&!(this.alpha<=0)){var b=this.angle,c=this.getScreenX(),d=this.getScreenY(),e=this.scale;return a.globalAlpha=this.alpha,a.save(),a.translate(c,d),a.scale(e.x,e.y),a.rotate(-b),a.beginPath(),a.rect(-this.handle.x,-this.handle.y,this.width,this.height),""!==this.fillStyle&&(this.fillStyle!==a.fillStyle&&(a.fillStyle=this.fillStyle),a.fill()),0!==this.lineWidth&&""!==this.strokeStyle&&(this.lineWidth!==a.lineWidth&&(a.lineWidth=this.lineWidth),this.strokeStyle!==a.strokeStyle&&(a.strokeStyle=this.strokeStyle),a.stroke()),a.restore(),this}},d.objects.Rectangle.prototype.draw=d.objects.Rectangle.prototype.autoDraw,d.objects.Rectangle.prototype.autoDrawCustom=function(a,b){a.globalAlpha=b&&void 0!==b.opacity?b.opacity:this.alpha,this.alpha>0&&this.visible&&(0!==this.angle?(a.save(),a.translate(this.x,this.y),a.rotate(-this.angle),a.drawImage(b&&void 0!==b.texture?b.texture:this.animations.idle[this.currentFrame].img,-this.handle.x,-this.handle.y),a.restore()):a.drawImage(b&&void 0!==b.texture?b.texture:this.animations.idle[this.currentFrame].img,this.x-this.handle.x,this.y-this.handle.y))},d.objects.Rectangle.prototype.drawBoundingBox=function(a,b,c){a.beginPath(),this.getVertices(),a.moveTo(this.vertices[3][0],this.vertices[3][1]);for(var d=0;4>d;d++)a.lineTo(this.vertices[d][0],this.vertices[d][1]);return a.closePath(),a.strokeStyle=b||"#FFFFFF",a.lineWidth=c||2,a.stroke(),this},d.objects.Rectangle.prototype.autoUpdate=function(a){var b=d.system.timeScale;this.speedX+=this.accelX*a*b,this.speedY+=this.accelY*a*b,this.x+=this.speedX*a*b,this.y+=this.speedY*a*b,this.rotation+=this.rotationAccel*a*b,this.angle+=this.rotation*a*b},d.objects.Rectangle.prototype.handleClick=function(a,b,c){if(this.isClickable){var d=this.scale,e=this.getScreenX(),f=this.getScreenY();if(0===this.angle){var g=e-d.x*this.handle.x,h=g+d.x*this.width,i=f-d.y*this.handle.y,j=i+d.y*this.height;if(g>h){var k=g;g=h,h=k}if(i>j){var k=i;i=j,j=k}if(a>=g&&h>=a&&b>=i&&j>=b&&this.isClickedPrecise(a,b)&&("mousedown"===c.type||"touchstart"===c.type))return this.onClick(a,b,c),!0}else if(0!==this.angle&&Math.jordanCurve(a,b,this.getVertices())&&this.isClickedPrecise(a,b)&&("mousedown"===c.type||"touchstart"===c.type))return this.onClick(a,b,c),!0}},d.objects.Rectangle.prototype.isClickedPrecise=function(a,b){var c=d.system.pixelContext[0];c.clearRect(-1,-1,3,3),c.save(),c.translate(-a,-b),this.autoDraw(c),c.restore();var e=c.getImageData(0,0,1,1).data;return 0!==e[3]},d.objects.Rectangle.prototype.getSpeedX=function(){return Math.vectorX(this.speed,this.direction)},d.objects.Rectangle.prototype.getSpeedY=function(){return Math.vectorY(this.speed,this.direction)},d.objects.Rectangle.prototype.applyForce=function(a,b){var c=this.getSpeedX(),d=this.getSpeedY(),e=Math.vectorX(a,b),f=Math.vectorY(a,b),g=c+e,h=d+f,i=Math.pow(Math.pow(g,2)+Math.pow(h,2),.5),j=Math.radToDeg(Math.atan2(-h,g));this.direction=j,this.speed=i},d.objects.Rectangle.prototype.moveTo=function(a){this.x=a.x,this.y=a.y},d.objects.Rectangle.prototype.moveToX=function(a){this.x=a},d.objects.Rectangle.prototype.move=function(a){this.x+=a.x,this.y+=a.y},d.objects.Rectangle.prototype.moveX=function(a){this.move({x:a,y:0})},d.objects.Rectangle.prototype.moveY=function(a){this.move({x:0,y:a})},d.objects.Rectangle.prototype.centerHandle=function(){this.handle={x:this.center.x,y:this.center.y}},d.objects.Rectangle.prototype.pushProperties=function(a,b){for(var c=b.length,d=0;c>d;d++)a[b[d]]=this[b[d]]},d.objects.Rectangle.prototype.pushPosition=function(a){a.x=this.x,a.y=this.y,a.offset={x:this.offset.x,y:this.offset.y}},d.objects.Rectangle.prototype.getVertices=function(){var a=window.Math,b=this.getScreenX()+this.offset.x,c=this.getScreenY()+this.offset.y,d=this.nudeVertices.length,e=this.angle,f=this.scale;if(0!==e)for(var g=0;d>g;g++)this.vertices[g]=[(this.nudeVertices[g][0]-this.handle.x)*a.cos(-e)-(this.nudeVertices[g][1]-this.handle.y)*a.sin(-e),(this.nudeVertices[g][0]-this.handle.x)*a.sin(-e)+(this.nudeVertices[g][1]-this.handle.y)*a.cos(-e)];else for(var g=0;d>g;g++)this.vertices[g]=[this.nudeVertices[g][0]-this.handle.x,this.nudeVertices[g][1]-this.handle.y];return this.vertices.mapQuick(function(a){a[0]=a[0]*f.x+b,a[1]=a[1]*f.y+c}),this.vertices},d.Frame=function(a,b){this.img=d.texture[a],this.length=b},d.Animation=function(){},d.objects.Rectangle.prototype.experimentalUpdate=function(a){var b=b;this.time+=a*b.system.timeScale;var c=c;this.time>=this.landingTime&&(this.energy<1&&(this.energy=0),this.direction=c.PI/2,this.y0=0,this.v=c.sqrt(2*this.g*this.energy/c.pow(c.sin(this.direction),2)),this.time-=this.landingTime,this.landingTime=(this.v*c.sin(this.direction)+c.sqrt(c.pow(this.v*c.sin(this.direction),2)+2*this.g*this.y0))/this.g),this.y=this.landingTime<a*b.system.timeScale?500:500-this.y0-(this.v*c.sin(this.direction)*this.time-this.g*this.time*this.time/2),this.y>=500&&(this.y=500),this.nextY=this.y,this.nextSpeedX+=this.accelX*a*b.system.timeScale,this.nextX+=this.nextSpeedX*b.system.dt*b.system.timeScale,this.nextX>=800&&(this.nextSpeedX=-this.speedX,this.speedX=-this.speedX,this.nextX=799),this.nextX<=49&&(this.nextSpeedX=-this.speedX,this.speedX=-this.speedX,this.nextX=50),this.x=this.nextX,this.speedX=this.nextSpeedX},a[b]=d}(window,"L");